# 이미지 다운로드
문제상황:  
서버가 클라이언트에게 JSON 뿐 아니라 이미지파일도 같이 주고 싶다.  
<br>  
send_image_with_Json() 따위의 마법같은 함수가 프레임워크 차원에서 제공 될거라 믿고 있었다.  
또는 그렇지 않더라도 HTTP 가 마법처럼 구현해주고 있을줄 알았다.  
해결책에는 생각보다 다양한 방법이 있다.  
<br>  
**0. 서버 사이드 렌더링**  
서버 프레임워크에서 제공하는 템플릿 엔진등을 이용해 최종 HTML을 렌더링하여 제공한다. 꽤 간단한 방법처럼 보이지만, 실제로 되는지 테스트해볼 필요가 있겠다. 된다고 하더라도 Next.js 등을 사용하지 않는 한 리액트는 클라이언트 사이드 렌더링 기반이고, 하고자 하는 원래 목적은 네트워크 상에서 이미지와 JSON을 클라이언트 단 까지 제공하고자 하는 것 이기때문에 주제에서 벗어남.  
<br>
**1.바이너리 데이터, 스트리밍**  
해보진 않았어도 바이너리 데이터가 대충 몇 백만 바이트인데, 네트워크 성능이 감당할 수 있을까 ?  
유튜브나 넷플릭스 같은 실시간 저지연 동영상 스트리밍 서비스 따위를 구현하고자 하는건 아니기 때문에, Contents Distribution Network 같은 기술을 이용한다는 맥락은 현재 관심 외.  
가장 원시적이고 Hacky 하지만 애초에 깔끔한 방법도 아닌 것 처럼 보인다.
<br>  
**2.별도의 파일서버 운용**  
배 보다 배꼽이 더 커지겠다.  
<br>
**3.별 이상한 고급 서드파티 기술 및 서비스 이용**  
대부분 자바 기반임.  
<br>
**4.웹서버 소프트웨어를 이용한 파일시스템 접근권한 부여 -> 정적 파일 제공**  
현재 프로젝트에서는 제공할 파일들의 보안이 요구되는 경우가 아니기 때문에(누구나 모든 가게의 로고와 메뉴를 마음껏 들여다봐도 된다.), 허용된 경로 이외의 접근에 대한 처리만 잘 한다면 가장 깔끔한 방법처럼 보인다.  
<br>
**5. Flask 의 send_file**  
단일 파일을 응답하는건 알겠는데 ,, 프로토콜 상에서 어떻게 동작하는지, Json 이랑 같이 넘기는게 가능할지, 여러 개 전송이 가능할지 등.. 일단은 문제가 많다.  
<br>  
## 결론
단일 요청에 대해 모든 데이터를 넘겨주겠다는 고정관념에서 벗어나야 함.  
첫 요청에 대한 응답으로 Json에 데이터와 이미지 경로를 제공한다.  
프론트에서 이미지 경로에 대한 추가적인 요청을 보낸다.  
각 요청에 대해 "동적 라우팅" 으로 이미지를 "단일 응답" 한다.  
<br>  
**추가적으로 알아보면 좋을 것들**  
템플릿 엔진으로 제공하는 방식이 어느 범위까지의 서버 사이드 렌더링인지 확실하게 알 필요가 있음.  
대용량, 대규모 트래픽에 대한 정적 리소스 처리는 별도의 이미지 스토리지를 운영하고, webp 포맷을 이용한 bandwidth 감소 처리가 필요하고, NginX 등을 이용하여 리버스 프록시를 두어 다중 호스트에 WAS를 분산처리하고 캐시서버 까지 운용할 필요가 있음.(CDN 이라는 접근은 이 맥락에서 나왔을 것으로 추정)  
